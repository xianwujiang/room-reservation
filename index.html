<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>会议室预约系统</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 20px;
      background: #f4f6f9; color: #333;
    }
    h1 { text-align: center; margin-bottom: 20px; }
    .container {
      max-width: 800px; margin: auto;
      background: #fff; padding: 20px;
      border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    label { display: block; margin-top: 12px; font-weight: bold; }
    input, select, button {
      margin-top: 6px; padding: 8px;
      border: 1px solid #ccc; border-radius: 6px; width: 100%;
    }
    button {
      background: #007BFF; color: white; cursor: pointer;
      transition: background 0.3s;
    }
    button:hover { background: #0056b3; }
    .list { margin-top: 20px; }
    .item {
      background: #fafafa; padding: 12px;
      border: 1px solid #ddd; border-radius: 8px; margin-top: 10px;
    }
    .pending { color: orange; }
    .approved { color: green; }
    .admin-panel { margin-top: 30px; padding: 15px; border: 2px dashed #007BFF; border-radius: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>会议室预约系统</h1>

    <div id="user-panel">
      <label>姓名：</label>
      <input id="name" type="text">

      <label>会议室：</label>
      <select id="room">
        <option value="物理楼304">物理楼304</option>
        <option value="物理楼307">物理楼307</option>
        <option value="学院楼304">学院楼304（需管理员审核）</option>
      </select>

      <label>开始时间：</label>
      <input id="startTime" type="datetime-local">

      <label>结束时间：</label>
      <input id="endTime" type="datetime-local">

      <button onclick="bookRoom()">提交预约</button>
    </div>

    <div class="list">
      <h3>预约记录</h3>
      <div id="bookings"></div>
    </div>

    <div class="admin-login">
      <h3>管理员登录</h3>
      <label>邮箱：</label>
      <input id="adminEmail" type="email" placeholder="输入邮箱">
      <label>密码：</label>
      <input id="adminPassword" type="password" placeholder="输入密码">
      <button onclick="toggleAdmin()">切换管理员模式</button>
    </div>

    <div id="admin-panel" class="admin-panel" style="display:none;">
      <h3>管理员待审核预约</h3>
      <div id="pending-list"></div>
    </div>
  </div>

  <script>
    // TODO: 替换为你的 firebaseConfig
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let isAdmin = false;

    function bookRoom() {
      const name = document.getElementById("name").value;
      const room = document.getElementById("room").value;
      const start = document.getElementById("startTime").value;
      const end = document.getElementById("endTime").value;

      if (!name || !start || !end) {
        alert("请填写完整信息");
        return;
      }

      const status = (room === "学院楼304") ? "待审核" : "已预约成功";

      db.collection("bookings").add({
        name, room, start, end, status,
        timestamp: new Date()
      });
    }

    function renderBookings(bookings) {
      const list = document.getElementById("bookings");
      list.innerHTML = "";
      bookings.forEach(doc => {
        const data = doc.data();
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <b>${data.name}</b> 预约 <b>${data.room}</b><br>
          ${data.start} - ${data.end}<br>
          状态: <span class="${data.status === "待审核" ? "pending" : "approved"}">${data.status}</span>
        `;
        list.appendChild(div);
      });
    }

    function renderPending(bookings) {
      const list = document.getElementById("pending-list");
      list.innerHTML = "";
      bookings.forEach(doc => {
        const data = doc.data();
        if (data.status === "待审核") {
          const div = document.createElement("div");
          div.className = "item";
          div.innerHTML = `
            <b>${data.name}</b> 请求预约 <b>${data.room}</b><br>
            ${data.start} - ${data.end}<br>
            <button onclick="approveBooking('${doc.id}')">批准</button>
            <button onclick="rejectBooking('${doc.id}')">拒绝</button>
          `;
          list.appendChild(div);
        }
      });
    }

    function approveBooking(id) {
      db.collection("bookings").doc(id).update({ status: "已预约成功" });
    }
    function rejectBooking(id) {
      db.collection("bookings").doc(id).delete();
    }

    function toggleAdmin() {
      const email = document.getElementById("adminEmail").value;
      const password = document.getElementById("adminPassword").value;
      if (email === "xwjiang@whut.edu.cn" && password === "admin123") {
        isAdmin = !isAdmin;
        document.getElementById("admin-panel").style.display = isAdmin ? "block" : "none";
        alert(isAdmin ? "已进入管理员模式" : "已退出管理员模式");
      } else {
        alert("管理员账号或密码错误");
      }
    }

    // 监听数据库变化
    db.collection("bookings").orderBy("timestamp", "desc").onSnapshot(snapshot => {
      const docs = snapshot.docs;
      renderBookings(docs);
      if (isAdmin) renderPending(docs);
    });
  </script>
</body>
</html>
