<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>会议预约系统</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6">
  <div class="max-w-4xl mx-auto bg-white p-6 rounded-2xl shadow-md">
    <h1 class="text-2xl font-bold mb-4 text-center">会议预约系统</h1>
    
    <!-- 管理员登录 -->
    <div class="mb-4">
      <input id="adminEmail" type="email" placeholder="管理员邮箱" class="border p-2 rounded w-full mb-2">
      <input id="adminPassword" type="password" placeholder="管理员密码" class="border p-2 rounded w-full mb-2">
      <button id="adminToggle" class="bg-blue-500 text-white px-4 py-2 rounded">切换管理员模式</button>
    </div>

    <!-- 普通用户预约 -->
    <div id="userSection">
      <h2 class="text-xl font-semibold mb-2">创建预约</h2>
      <input id="userName" type="text" placeholder="您的姓名" class="border p-2 rounded w-full mb-2">
      <input id="contact" type="text" placeholder="联系方式（手机号）" class="border p-2 rounded w-full mb-2">
      <textarea id="meetingTopic" placeholder="会议主题" class="border p-2 rounded w-full mb-2"></textarea>
      
      <div class="flex gap-2 mb-2">
        <select id="year" class="border p-2 rounded"></select>
        <select id="month" class="border p-2 rounded"></select>
        <select id="day" class="border p-2 rounded"></select>
        <select id="hour" class="border p-2 rounded"></select>
        <select id="minute" class="border p-2 rounded"></select>
      </div>
      <button id="createBtn" class="bg-green-500 text-white px-4 py-2 rounded">创建预约</button>
    </div>

    <!-- 管理员界面 -->
    <div id="adminSection" class="hidden mt-6">
      <h2 class="text-xl font-semibold mb-2">管理员功能</h2>
      <p class="mb-2 text-gray-700">浏览次数：<span id="visitCount">0</span></p>
      <h3 class="text-lg font-semibold">预约列表</h3>
      <ul id="adminList" class="space-y-2 mt-2"></ul>
    </div>

    <!-- 普通预约列表 -->
    <div id="reservationSection" class="mt-6">
      <h2 class="text-xl font-semibold mb-2">预约列表</h2>
      <ul id="reservationList" class="space-y-2"></ul>
    </div>
  </div>

  <script>
    const adminEmailInput = document.getElementById("adminEmail");
    const adminPasswordInput = document.getElementById("adminPassword");
    const adminToggle = document.getElementById("adminToggle");
    const adminSection = document.getElementById("adminSection");
    const userSection = document.getElementById("userSection");
    const reservationList = document.getElementById("reservationList");
    const adminList = document.getElementById("adminList");
    const visitCountEl = document.getElementById("visitCount");

    const yearSel = document.getElementById("year");
    const monthSel = document.getElementById("month");
    const daySel = document.getElementById("day");
    const hourSel = document.getElementById("hour");
    const minuteSel = document.getElementById("minute");

    // 初始化本地存储数据
    let reservations = JSON.parse(localStorage.getItem("reservations")) || [];
    let visitCount = parseInt(localStorage.getItem("visitCount")) || 0;

    // 访问计数
    visitCount++;
    localStorage.setItem("visitCount", visitCount);
    visitCountEl.textContent = visitCount;

    // 填充年份、月份、日期、时间
    const now = new Date();
    for (let y = now.getFullYear(); y <= now.getFullYear() + 1; y++) {
      yearSel.innerHTML += `<option value="${y}">${y}</option>`;
    }
    for (let m = 1; m <= 12; m++) {
      monthSel.innerHTML += `<option value="${m}">${m}</option>`;
    }
    for (let d = 1; d <= 31; d++) {
      daySel.innerHTML += `<option value="${d}">${d}</option>`;
    }
    for (let h = 0; h < 24; h++) {
      hourSel.innerHTML += `<option value="${h}">${h}</option>`;
    }
    for (let min = 0; min < 60; min += 5) {
      minuteSel.innerHTML += `<option value="${min}">${min}</option>`;
    }

    // 渲染列表
    function renderLists() {
      reservationList.innerHTML = "";
      adminList.innerHTML = "";

      reservations.forEach((r, idx) => {
        const liUser = document.createElement("li");
        liUser.className = "border p-2 rounded";
        liUser.textContent = `${r.name} (${r.contact}) - ${r.topic} - ${r.time}`;
        reservationList.appendChild(liUser);

        const liAdmin = document.createElement("li");
        liAdmin.className = "border p-2 rounded flex justify-between items-center";
        liAdmin.innerHTML = `
          <span>${r.name} (${r.contact}) - ${r.topic} - ${r.time}</span>
          <div>
            <button onclick="deleteReservation(${idx})" class="bg-red-500 text-white px-2 py-1 rounded">删除</button>
          </div>
        `;
        adminList.appendChild(liAdmin);
      });
    }

    // 删除预约
    window.deleteReservation = function(idx) {
      reservations.splice(idx, 1);
      localStorage.setItem("reservations", JSON.stringify(reservations));
      renderLists();
    }

    renderLists();

    // 创建预约
    document.getElementById("createBtn").addEventListener("click", () => {
      const name = document.getElementById("userName").value.trim();
      const contact = document.getElementById("contact").value.trim();
      const topic = document.getElementById("meetingTopic").value.trim();
      const time = `${yearSel.value}-${monthSel.value}-${daySel.value} ${hourSel.value}:${minuteSel.value}`;

      if (!name || !contact || !topic) {
        alert("请填写完整信息！");
        return;
      }

      reservations.push({ name, contact, topic, time });
      localStorage.setItem("reservations", JSON.stringify(reservations));
      renderLists();
    });

    // 管理员模式
    adminToggle.addEventListener("click", () => {
      if (adminEmailInput.value === "xwjiang@whut.edu.cn" && adminPasswordInput.value === "admin123") {
        adminSection.classList.toggle("hidden");
      } else {
        alert("管理员账号或密码错误！");
      }
    });

    // 分钟选择后隐藏时间选择框
    minuteSel.addEventListener("change", () => {
      yearSel.classList.add("hidden");
      monthSel.classList.add("hidden");
      daySel.classList.add("hidden");
      hourSel.classList.add("hidden");
      minuteSel.classList.add("hidden");
    });
  </script>
</body>
</html>
