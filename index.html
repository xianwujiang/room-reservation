<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>物理与力学学院会议室预约系统（美观界面版）</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        :root{
          --brand:#4CAF50;--brand-dark:#3c9442;--danger:#e5534b;--muted:#6b7280;--bg:#f0f2f5;--card:#fff
        }
        body { font-family: 'Helvetica Neue', Arial, sans-serif; margin: 0; background: var(--bg); }
        h2 { text-align: center; margin: 20px 0; color: #333; }
        .container { display: flex; flex-wrap: wrap; max-width: 1200px; margin: 0 auto; padding: 20px; gap: 12px; }
        .card { background: var(--card); border-radius: 12px; box-shadow: 0 6px 18px rgba(0,0,0,0.08); padding: 20px; flex: 1; min-width: 280px; }
        .card h3{margin:0 0 10px 0}
        input, select, button, textarea { margin: 6px 0; padding: 10px 12px; font-size: 14px; border-radius: 8px; border: 1px solid #ddd; width: 100%; box-sizing: border-box; }
        input:focus, select:focus { outline: none; border-color: var(--brand); box-shadow: 0 0 0 3px rgba(76,175,80,.15); }
        button { background-color: var(--brand); color: white; border: none; cursor: pointer; transition: 0.2s; font-weight: 600; }
        button:hover { background-color: var(--brand-dark); }
        .btn-plain{background:#eef2f7;color:#111}
        .btn-danger{background: var(--danger);} .btn-danger:hover{filter:brightness(.95)}
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        th, td { border: 1px solid #eee; padding: 10px; text-align: center; font-size: 14px; }
        th { background-color: var(--brand); color: white; position: sticky; top:0; z-index:1 }
        tr:nth-child(even) { background-color: #fafafa; }
        tr.pending { background-color: #fff4e5; }
        .tag{display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px}
        .tag-ok{background:#e7f7ec;color:#1e7d3b;border:1px solid #b9e5c7}
        .tag-pending{background:#fff5e6;color:#a7630b;border:1px solid #ffd59e}
        .admin-controls button { margin: 0 4px 6px 0; }
        .toast { visibility: hidden; min-width: 220px; background-color: #111; color: #fff; text-align: center; border-radius: 6px; padding: 10px 12px; position: fixed; z-index: 20; left: 50%; transform: translateX(-50%); bottom: 28px; font-size: 14px; }
        .toast.show { visibility: visible; animation: fadein 0.25s, fadeout 0.25s 2.6s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 28px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 28px; opacity: 1;} to {bottom: 0; opacity: 0;} }
        .modal-backdrop{display:none;position:fixed;inset:0;background:rgba(0,0,0,.35);z-index:30;align-items:center;justify-content:center}
        .modal{width: 420px; max-width: calc(100% - 28px); background:#fff;border-radius:12px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.2)}
        .modal h4{margin:4px 0 8px 0}
        .modal .row{display:flex;gap:8px}
        .modal .row>div{flex:1}
        .modal .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:8px}
    </style>
</head>
<body>
    <h2>会议室预约系统</h2>
    <div class="container">
        <div class="card">
            <h3>新建预约</h3>
            <input type="text" id="name" placeholder="姓名">
            <input type="text" id="phone" placeholder="联系电话">
            <select id="room">
                <option value="304P">物理楼304</option>
                <option value="307P">物理楼307</option>
                <option value="304C">学院楼304（需管理员审核）</option>
            </select>
            <input type="date" id="date">
            <div class="row">
              <div>
                <label style="font-size:12px;color:var(--muted)">开始时间</label>
                <input type="time" id="time" placeholder="开始时间">
              </div>
              <div>
                <label style="font-size:12px;color:var(--muted)">结束时间</label>
                <input type="time" id="endTime" placeholder="结束时间">
              </div>
            </div>
            <button id="createBtn">创建预约</button>
        </div>
        <div class="card">
            <h3>管理员登录</h3>
            <input type="email" id="adminEmail" placeholder="管理员邮箱">
            <input type="password" id="adminPass" placeholder="管理员密码">
            <button id="toggleAdminBtn">切换管理员模式</button>
            <div id="adminStatus" style="margin-top:6px;color:var(--muted);font-size:13px">当前身份：普通用户</div>
        </div>
        <div class="card" style="flex-basis: 100%;">
            <h3>预约列表</h3>
            <table id="bookingsTable">
                <thead>
                    <tr><th>姓名</th><th>联系电话</th><th>会议室</th><th>日期</th><th>开始时间</th><th>结束时间</th><th>状态</th><th>操作</th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <!-- 编辑时间 Modal -->
    <div id="editBackdrop" class="modal-backdrop">
      <div class="modal">
        <h4>调整预约时间</h4>
        <div class="row">
          <div>
            <label style="font-size:12px;color:var(--muted)">日期</label>
            <input type="date" id="editDate">
          </div>
          <div></div>
        </div>
        <div class="row">
          <div>
            <label style="font-size:12px;color:var(--muted)">开始时间</label>
            <input type="time" id="editTime">
          </div>
          <div>
            <label style="font-size:12px;color:var(--muted)">结束时间</label>
            <input type="time" id="editEndTime">
          </div>
        </div>
        <div class="actions">
          <button class="btn-plain" onclick="closeModal()">取消</button>
          <button onclick="saveEdit()">保存</button>
        </div>
      </div>
    </div>

<div id="toast" class="toast"></div>

<!-- LeanCloud JS SDK（国内可直连） -->
<script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.15.2/dist/av-min.js"></script>

<script>
// ========== LeanCloud 初始化 ==========
AV.init({
  appId: '5Iaoq4hibBBb9UuVJjcxIdmG-gzGzoHsz',
  appKey: 'aZ7XXWukyQssef8hr9P0voRf',
  serverURLs: 'https://5iaoq4hi.lc-cn-n1-shared.com'
});

// 在 addBooking 保存时增加 phone 字段
// 在 upsertRow 渲染时增加 phone 列
</script>
</body>
</html>
